<!--
    Template page, copy and paste to use
-->

<!doctype html>
<html lang="en">
   <head>
      <!-- Required meta tags -->
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <!-- Bootstrap CSS -->
      <link rel="stylesheet" href="./lib/custom/main.css">
      <link rel="stylesheet" href="./lib/css/bootstrap.min.css">
      <title>Trader APP</title>
   </head>
   <body>
      <!-- ================================================ Top Navbar ================================================ -->
      <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top" id="navbar_top">
         <div class="navbar-header">
            <a class="navbar-brand" href="#">
            <i class="fa fa-copyright"></i>&nbsp;Trader APP</a>
            <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbar2SupportedContent">
               <span class="navbar-toggler-icon"></span>
               <p> <font color="white">v0.0.1 </font></p>
            </button>
         </div>
      </nav>
      <!-- ================================================ Landing Page ================================================ -->
      <div class="container-fluid">
         <div class="container jumbotron">
            <h1 align="center">Trader App Editor</h1>
            <br>
            <div class="row">
               <div class="col-sm-6">
                  <span class="badge badge-secondary">
                     <h7>File Name : </h7>
                  </span>
                  <span id="file-name"></span>
               </div>
               <div class="col-sm-3">
                  <span class="badge badge-secondary">
                     <h7>Owner : </h7>
                  </span>
               </div>
            </div>
            <!-- for resize for editor to fit parent div -->
            <div id="editorContainer">
               <!-- editor panel -->
               <div id="aceEditor">
                  Do something here...  
               </div>
               <!-- editor goes here -->
            </div>
            <!-- for resize for editor to fit parent div -->
            <div id="file-content" style="display: none;"></div>
            <div class="btn-group btn-group-justified" id="wrapper">
               <div class="fileOpen btn btn-primary btncustom">
                  <span>OPEN</span>
                  <input type="file" id="file-input" class="open" />
               </div>
               <div class="fileOpen btn btn-success btncustom">
                  <span>SAVE</span>
                  <input type="button" id="file-save" class="open"/>
               </div>
               <button type="button" class="btn btn-danger btncustom" id="file-discard">DISCARD</button>
            </div>
         </div>
      </div>
      <!-- ================================================ Bottom Navbar ================================================ -->
      <div class="navbar fixed-bottom navbar-expand-md bg-dark navbar-dark text-nowrap">
         <span class="hide-phone footer-link">
         <a class="navbar-brand mx-auto px-5" href="#">Copyright Â© 2018 by Kevin Cyu. All rights reserved.</a>
         </span>
         <span style="float:right;"><font color="white">EFACANI, Trader App Team</font></span>
      </div>
   </body>
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<!-- In Electron, this is the correct way to include jQuery -->
<script>window.$ = window.jQuery = require('./lib/js/jquery-3.3.1.min.js');</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.3.3/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
var editor;
initAceEditor();

function readSingleFile(e) {
  var file = e.target.files[0];
  if (!file) {
    return;
  }
  document.getElementById('file-name').innerText = file.name;
  var reader = new FileReader();
  reader.onload = function(e) {
    var contents = e.target.result;
    displayContents(contents);
    editor.setValue(contents);
  };
  reader.readAsText(file);
}

function displayContents(contents) {
  var element = document.getElementById('file-content');
  element.innerText = contents;
  console.log(element.innerText);
  initAceEditor()
}

document.getElementById('file-input')
  .addEventListener('change', readSingleFile, false);

$( "#file-discard" ).click(function() {
  clearEditor();
});

function initAceEditor() {
    editor = ace.edit("aceEditor");
    editor.setTheme("ace/theme/monokai");
    editor.getSession().setMode("ace/mode/yaml");
    editor.getSession().setOptions({newLineMode: "auto"});
    editor.setFontSize("15px") ;
    editor.setPrintMarginColumn(false);
    // editor.setValue($("#file-content").text());
    editor.setOptions({
        autoScrollEditorIntoView: true,
        copyWithEmptySelection: true,
        animatedScroll: true
    })
    editor.setOption("mergeUndoDeltas", "always");
}

function clearEditor(){
  editor.setValue("");
}
</script>
</html>
